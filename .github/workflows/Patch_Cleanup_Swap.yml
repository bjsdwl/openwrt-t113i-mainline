name: OpenWrt - Patch Cleanup & Swap

on:
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      
      - name: Swap Patches
        run: |
          cd patches-uboot
          
          # 检查是否存在冲突
          if [ -f "001-add-t113-tronlong-dts.patch" ] && [ -f "005-fix-uart0-pinctrl.patch" ]; then
              echo ">>> Replacing old 001 with new 005..."
              rm 001-add-t113-tronlong-dts.patch
              mv 005-fix-uart0-pinctrl.patch 001-add-t113-tronlong-dts.patch
              echo "✅ Done. 001 is now the updated version."
          else
              echo "⚠️ Files not found as expected. Please check manually."
              ls -l
          fi
          
      - name: Commit Changes
        run: |
          git config --global user.name "Patch Manager"
          git config --global user.email "actions@github.com"
          git add patches-uboot/
          git commit -m "refactor: replace old dts patch with fixed version" || echo "No changes"
          git push
