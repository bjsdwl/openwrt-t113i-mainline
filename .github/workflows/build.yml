# ...前面的步骤保持不变...

      - name: Apply Custom Configuration
        run: |
          cd openwrt
          chmod +x $GITHUB_WORKSPACE/diy-part2.sh
          $GITHUB_WORKSPACE/diy-part2.sh
          
          # 强制刷新配置环境
          [ -e $GITHUB_WORKSPACE/seed.config ] && cp $GITHUB_WORKSPACE/seed.config .config
          make defconfig
          
          # 关键诊断：查看最终 Makefile 确保劫持成功
          echo ">>> [CHECK] uboot-sunxi Makefile preview:"
          grep "UBOOT_TARGETS :=" package/boot/uboot-sunxi/Makefile

      - name: Compile U-Boot
        id: compile
        run: |
          cd openwrt
          # 1. 彻底清除旧产物和标志文件
          make package/boot/uboot-sunxi/clean
          # 2. 强制编译，使用单线程 V=s 方便查看报错
          make package/boot/uboot-sunxi/compile V=s
          echo "status=success" >> $GITHUB_OUTPUT

      - name: "FORENSICS: Diagnostics"
        if: steps.compile.outputs.status == 'success'
        run: |
          mkdir -p $GITHUB_WORKSPACE/outputs
          # 此时产物名字可能被 OpenWrt 改成了 xunlong_orangepi-one-u-boot-with-spl.bin
          # 我们广撒网搜索
          find openwrt/bin/targets/sunxi/ -name "*with-spl.bin" -exec cp {} $GITHUB_WORKSPACE/outputs/t113i-hijacked-u-boot.bin \; || true
          
          # 如果 bin 目录下没有，去源码目录深挖
          if [ ! -f "$GITHUB_WORKSPACE/outputs/t113i-hijacked-u-boot.bin" ]; then
              UBOOT_BUILD_DIR=$(find openwrt/build_dir -type d -name "u-boot-orangepi_one")
              [ -f "$UBOOT_BUILD_DIR/u-boot-sunxi-with-spl.bin" ] && cp "$UBOOT_BUILD_DIR/u-boot-sunxi-with-spl.bin" $GITHUB_WORKSPACE/outputs/t113i-hijacked-u-boot.bin
          fi
          
          # 反编译验证
          UBOOT_BUILD_DIR=$(find openwrt/build_dir -type d -name "u-boot-orangepi_one" | head -n 1)
          if [ -n "$UBOOT_BUILD_DIR" ]; then
              [ -f "$UBOOT_BUILD_DIR/u-boot.dtb" ] && dtc -I dtb -O dts "$UBOOT_BUILD_DIR/u-boot.dtb" > "$GITHUB_WORKSPACE/outputs/debug-final-u-boot.dts"
          fi
          ls -lh $GITHUB_WORKSPACE/outputs/

      # ...后续上传步骤保持不变...
